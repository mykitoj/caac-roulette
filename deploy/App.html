<!DOCTYPE html>
<html>
<head>
    <title>CAAC-Roulette</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){this._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Loading... Please wait."}),this._myMask.show();var filters=[];filters.push(Ext.create("Rally.data.wsapi.Filter",{property:"Deleted",operator:"=",value:"false"})),filters.push(Ext.create("Rally.data.wsapi.Filter",{property:"Disabled",operator:"=",value:"false"}));var activeDate=new Date;activeDate.setDate(activeDate.getDate()-30),filters.push(Ext.create("Rally.data.wsapi.Filter",{property:"LastActiveDate",operator:">=",value:activeDate}));var store=Ext.create("Rally.data.wsapi.Store",{model:"User",fetch:["DefaultProject","DisplayName","EmailAddress","FirstName","Language","LastActiveDate","LastName","MiddleName","OfficeLocation","Phone","Role"],sorters:[{property:"LastActiveDate",direction:"DESC"}],context:this.getContext().getDataContext(),pageSize:200,limit:200},this);store.addFilter(filters,!1),store.loadPage(1,{scope:this,callback:function(records,operation){operation.wasSuccessful()?(this._myMask.hide(),this.displayUser(records,null)):(this._myMask.hide(),this.clearContent(),this.addLabel(this,"Error loading users<br/>"),this.addLabel(this,operation.error.errors[0]))}})},displayUser:function(records,priorUser){this.clearContent();var user;do user=records[Math.floor(Math.random()*records.length)].data;while(null!==priorUser&&user.ObjectID===priorUser.ObjectID);this._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Loading... Please wait."}),this._myMask.show();var filters=[];filters.push(Ext.create("Rally.data.wsapi.Filter",{property:"Owner.ObjectID",operator:"=",value:user.ObjectID}));var store=Ext.create("Rally.data.wsapi.Store",{model:"UserStory",fetch:["FormattedID","Name"],sorters:[{property:"LastUpdateDate",direction:"DESC"}],context:this.getContext().getDataContext(),pageSize:3,limit:3},this);store.addFilter(filters,!1),store.loadPage(1,{scope:this,callback:function(workItemRecords,operation){if(operation.wasSuccessful()){this._myMask.hide();var fullBox=this.add({xype:"container",border:0,layout:{type:"vbox",align:"stretch"}}),detailsBox=fullBox.add({xype:"container",border:0,flex:1,layout:{type:"hbox",align:"stretch"}}),leftSide=detailsBox.add({xype:"container",border:0,flex:1,layout:{type:"vbox",align:"stretch"}}),color="#"+(user.ObjectID%1e6).toString().padStart(6,"0"),userName=_.compact([user.FirstName,user.MiddleName,user.LastName]).join(" ");this.addLabel(leftSide,userName),user.DisplayName&&user.DisplayName!==userName&&this.addLabel(leftSide,"aka: "+user.DisplayName),user.Role&&"None"!==user.Role&&(this.addHeader(leftSide,"Role",color),this.addLabel(leftSide,user.Role)),user.OfficeLocation&&"None"!==user.OfficeLocation&&(this.addHeader(leftSide,"Office Location",color),this.addLabel(leftSide,user.OfficeLocation)),user.EmailAddress&&(this.addHeader(leftSide,"Email",color),this.addLabel(leftSide,'<a href="mailto:'+user.EmailAddress+'">'+user.EmailAddress+"</a>")),user.Phone&&(this.addHeader(leftSide,"Phone",color),this.addLabel(leftSide,'<a href="tel:'+user.Phone+'">'+user.Phone+"</a>")),user.Language&&(this.addHeader(leftSide,"Language",color),this.addLabel(leftSide,user.Language)),user.DefaultProject&&user.DefaultProject._refObjectName&&(this.addHeader(leftSide,"Default Project",color),this.addLabel(leftSide,user.DefaultProject._refObjectName)),this.addHeader(leftSide,"Last Active Date",color),this.addLabel(leftSide,user.LastActiveDate.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));var rightSide=detailsBox.add({xype:"container",border:0,flex:1,layout:{type:"vbox"}});this.addButton(rightSide,"Â» Next User",color,function(){this.displayUser(records,user.ObjectID)}),this.addLabel(rightSide,"<br/>"),rightSide.add({xtype:"image",src:"http://rally1.rallydev.com/slm/profile/image/"+user.ObjectID+"/100.sp",height:"100px",width:"100px"});var workBox=fullBox.add({xype:"container",border:0,flex:1,layout:{type:"vbox",align:"stretch"}});workItemRecords.length>0&&(this.addHeader(workBox,"Recent Stories",color),_.each(workItemRecords,function(workItemRecord){var workItemBox=workBox.add({xype:"container",border:0,flex:1,layout:{type:"hbox",align:"stretch"},padding:"5 0 0 0"});this.addButton(workItemBox,workItemRecord.data.FormattedID,color,function(){Rally.nav.Manager.showDetail(workItemRecord.raw._ref)}),this.addLabel(workItemBox,workItemRecord.data.Name)},this))}else this._myMask.hide(),this.clearContent(),this.addLabel(this,"Error loading users<br/>"),this.addLabel(this,operation.error.errors[0])}})},addHeader:function(parent,text,color){parent.add({xtype:"label",html:"<u><b>"+text+"</b></u>",style:{"font-size":"13px",color:color?color:"#333333"},padding:"5 0 1 0"})},addLabel:function(parent,text){parent.add({xtype:"label",html:text,style:{"font-size":"15px"}})},addButton:function(parent,text,color,handler){var button=parent.add({xtype:"rallybutton",text:text,handler:handler,scope:this,style:{"background-color":color,"border-color":color}});button.getEl().down(".x-btn-inner").setStyle({color:"#FFFFFF","font-size":"15px"})},clearContent:function(){for(;this.down("*");)this.down("*").destroy()}});

            Rally.launchApp('CustomApp', {
                name:"CAAC-Roulette",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
