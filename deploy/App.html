<!DOCTYPE html>
<html>
<head>
    <title>CAAC-Roulette</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){this._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Loading... Please wait."}),this._myMask.show();var e=[];e.push(Ext.create("Rally.data.wsapi.Filter",{property:"Deleted",operator:"=",value:"false"})),e.push(Ext.create("Rally.data.wsapi.Filter",{property:"Disabled",operator:"=",value:"false"}));var t=new Date;t.setDate(t.getDate()-30),e.push(Ext.create("Rally.data.wsapi.Filter",{property:"LastActiveDate",operator:">=",value:t}));var a=Ext.create("Rally.data.wsapi.Store",{model:"User",fetch:["DefaultProject","DisplayName","EmailAddress","FirstName","Language","LastActiveDate","LastName","MiddleName","OfficeLocation","Phone","Role"],sorters:[{property:"LastActiveDate",direction:"DESC"}],context:this.getContext().getDataContext(),pageSize:200,limit:200},this);a.addFilter(e,!1),a.loadPage(1,{scope:this,callback:function(e,t){t.wasSuccessful()?(this._myMask.hide(),this.displayUser(e,null)):(this._myMask.hide(),this.clearContent(),this.addLabel(this,"Error loading users<br/>"),this.addLabel(this,t.error.errors[0]))}})},displayUser:function(e,t){var a;this.clearContent();do{a=e[Math.floor(Math.random()*e.length)].data}while(null!==t&&a.ObjectID===t.ObjectID);this._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Loading... Please wait."}),this._myMask.show();var r=new Date;r.setDate(r.getDate()-90),Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["FormattedID","Name"],context:this.getContext().getDataContext(),includeTotalResultCount:!1,removeUnauthorizedSnapshots:!0,compress:!0,pageSize:10,limit:10,filters:[{property:"_TypeHierarchy",operator:"=",value:"HierarchicalRequirement"},{property:"Owner",operator:"=",value:a.ObjectID},{property:"ScheduleState",operator:">",value:"Defined"},{property:"_ValidFrom",operator:">=",value:r}],sorters:[{property:"_ValidFrom",direction:"DESC"}]}).load({scope:this,callback:function(t,r){if(r.wasSuccessful()){this._myMask.hide();var o=this.add({xype:"container",border:0,layout:{type:"vbox",align:"stretch"}}),i=o.add({xype:"container",border:0,flex:1,layout:{type:"hbox",align:"stretch"}}),d=i.add({xype:"container",border:0,flex:1,layout:{type:"vbox",align:"stretch"}}),s="#"+(a.ObjectID%1e6).toString().padStart(6,"0"),l=_.compact([a.FirstName,a.MiddleName,a.LastName]).join(" ");this.addLabel(d,l),a.DisplayName&&a.DisplayName!==l&&this.addLabel(d,"aka: "+a.DisplayName),a.Role&&"None"!==a.Role&&(this.addHeader(d,"Role",s),this.addLabel(d,a.Role)),a.OfficeLocation&&"None"!==a.OfficeLocation&&(this.addHeader(d,"Office Location",s),this.addLabel(d,a.OfficeLocation)),a.EmailAddress&&(this.addHeader(d,"Email",s),this.addLabel(d,'<a href="mailto:'+a.EmailAddress+'">'+a.EmailAddress+"</a>")),a.Phone&&(this.addHeader(d,"Phone",s),this.addLabel(d,'<a href="tel:'+a.Phone+'">'+a.Phone+"</a>")),a.Language&&(this.addHeader(d,"Language",s),this.addLabel(d,a.Language)),a.DefaultProject&&a.DefaultProject._refObjectName&&(this.addHeader(d,"Default Project",s),this.addLabel(d,a.DefaultProject._refObjectName)),a.LastActiveDate&&(this.addHeader(d,"Last Active Date",s),this.addLabel(d,a.LastActiveDate.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})));var n=i.add({xype:"container",border:0,flex:1,layout:{type:"vbox"}});this.addButton(n,"Â» Next User",s,function(){this.displayUser(e,a.ObjectID)}),this.addLabel(n,"<br/>"),n.add({xtype:"image",src:"http://rally1.rallydev.com/slm/profile/image/"+a.ObjectID+"/100.sp",height:"100px",width:"100px"});var c=o.add({xype:"container",border:0,flex:1,layout:{type:"vbox",align:"stretch"}});if(t.length>0){this.addHeader(c,"Recent Stories",s);var h=[];_.each(t,function(e){if(!h.includes(e.data.FormattedID)){var t=c.add({xype:"container",border:0,flex:1,layout:{type:"hbox",align:"stretch"},padding:"5 0 0 0"});this.addButton(t,e.data.FormattedID,s,function(){Rally.nav.Manager.showDetail(e.raw._ref)}),this.addLabel(t,e.data.Name),h.push(e.data.FormattedID)}},this)}}else this._myMask.hide(),this.clearContent(),this.addLabel(this,"Error loading users<br/>"),this.addLabel(this,r.error.errors[0])}})},addHeader:function(e,t,a){e.add({xtype:"label",html:"<u><b>"+t+"</b></u>",style:{"font-size":"13px",color:a||"#333333"},padding:"5 0 1 0"})},addLabel:function(e,t){e.add({xtype:"label",html:t,style:{"font-size":"15px"}})},addButton:function(e,t,a,r){e.add({xtype:"rallybutton",text:t,handler:r,scope:this,style:{"background-color":a,"border-color":a}}).getEl().down(".x-btn-inner").setStyle({color:"#FFFFFF","font-size":"15px"})},clearContent:function(){for(;this.down("*");)this.down("*").destroy()}});

            Rally.launchApp('CustomApp', {
                name:"CAAC-Roulette",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
